<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MKTG 430 - A/B Test Voting Platform</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Recharts -->
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

    const ABTestData = [
      {
        team: "ImageTest - Memorial Art Gallery",
        testType: "Image",
        postA: {
          copy: "Come join the Memorial Art Gallery for our Paint and Play night! Bring your kids and their friends this Thursday for an evening of artistic exploration, community and inspiration. Don't miss out, this adventure will begin at 6:00 pm.",
          image: "https://drive.google.com/uc?export=view&id=1oyA1e59uodFxH6Lm1ZOKkxptQKI1xLU-"
        },
        postB: {
          copy: "Come join the Memorial Art Gallery for our Paint and Play night! Bring your kids and their friends this Thursday for an evening of artistic exploration, community and inspiration. Don't miss out, this adventure will begin at 6:00 pm.",
          image: "https://drive.google.com/uc?export=view&id=1X7iExJ1Ob33mfuZSoIVjmvegUZU1ANto"
        }
      },
      {
        team: "CopyTest - Crocs",
        testType: "Copy",
        postA: {
          copy: "Embrace your inner ninja with our Naruto collection, available 10/22! #Naruto #Crocs",
          image: "https://drive.google.com/uc?export=view&id=1KF7rHkPps0JHVDpGYzrj1X7pbs_OxvHG"
        },
        postB: {
          copy: "Twin with everyone's favorite alien on 10/22! Disney Stitch collection available now! üëΩ #Disney #Stitch #Crocs",
          image: "https://drive.google.com/uc?export=view&id=15Jmvl2hPulRwPpAWBEK9h42FUY91whNV"
        }
      },
      {
        team: "CopyTest - Duolingo",
        testType: "Copy",
        postA: {
          copy: "Nobody ignores me....for long",
          image: "https://drive.google.com/uc?export=view&id=1-Ye3DcwG5Ja8DCZQjAsG5N-gG-o8BNWm"
        },
        postB: {
          copy: "I miss you, please come back!",
          image: "https://drive.google.com/uc?export=view&id=1VcKX4dZu_AnR0A3LuUxLuSdYOLvCBIlE"
        }
      },
      {
        team: "CopyTest - Tim Hortons",
        testType: "Copy/Audience",
        postA: {
          copy: "Whipped iced coffee - targeting Gen Z (currently trending)",
          image: "https://drive.google.com/uc?export=view&id=1veMb5VWvPYUnfy7BYbNMqwLFVGLwGV4I"
        },
        postB: {
          copy: "Black mug with red logo - targeting Millennials+ (vintage, fun style)",
          image: "https://drive.google.com/uc?export=view&id=1inR2uaYjNuVf1FmMOpTPm72dAwEaVzsX"
        }
      },
      {
        team: "ImageTest - Spirit Airlines",
        testType: "Image",
        postA: {
          copy: "Fly Spirit With our Cheapest Prices Yet!",
          image: "https://drive.google.com/uc?export=view&id=1yDeivUF_vDtN-mmGZ4t-CqT73rRQmGWp"
        },
        postB: {
          copy: "Fly Spirit With our Cheapest Prices Yet!",
          image: "https://drive.google.com/uc?export=view&id=1wlD8r_khF9s4gUj1Heq88aa6IQSkjAe9"
        }
      },
      {
        team: "ImageTest - Duolingo",
        testType: "Image",
        postA: {
          copy: "When Duolingo starts losing patience with you...",
          image: "https://drive.google.com/uc?export=view&id=1PAVD7Ch0MjJtRVn7DtaO2paoKzOfcMnx"
        },
        postB: {
          copy: "When Duolingo starts losing patience with you...",
          image: "https://drive.google.com/uc?export=view&id=1LbDBKRx2bWA2DRGQL9yc8SHiEePvOQoQ"
        }
      },
      {
        team: "ImageTest - Wegmans",
        testType: "Image",
        postA: {
          copy: "Buffalo Chicken Dip, your new game day MVP üî•üêî‚Å£ Whether you're hosting or just snacking, this dip never disappoints.",
          image: "https://drive.google.com/uc?export=view&id=1WYkD3rvW5fLbSqR--SIOnFtAmleAIwTe"
        },
        postB: {
          copy: "Buffalo Chicken Dip, your new game day MVP üî•üêî‚Å£ Whether you're hosting or just snacking, this dip never disappoints.",
          image: "https://drive.google.com/uc?export=view&id=1aZxOhfztCpoqfGIvT4ZbLkfizEVp7aKh"
        }
      },
      {
        team: "CopyTest - Liquid Death",
        testType: "Copy",
        postA: {
          copy: "teenagers drinking liquid death",
          image: "https://drive.google.com/uc?export=view&id=1aL46AfoFoTvPJ-6o2oFGL3jSi7EgWPrd"
        },
        postB: {
          copy: "Pilot drinking liquid death with passengers",
          image: "https://drive.google.com/uc?export=view&id=1BYYZCtNImAwCwM51HQEr83K2Fb_rCEj7"
        }
      },
      {
        team: "ImageTest - Denny's",
        testType: "Image",
        postA: {
          copy: "Pull up a chair. Stay a while. Whether you're here for the pancakes or the people, you know you're always welcome at our table.",
          image: "https://drive.google.com/uc?export=view&id=1LE798mn_UlxdN3E9q3seupunBvxxhowm"
        },
        postB: {
          copy: "Pull up a chair. Stay a while. Whether you're here for the pancakes or the people, you know you're always welcome at our table.",
          image: "https://drive.google.com/uc?export=view&id=1pFeabC3ivravHfbDfnPoD1cML3biGEK2"
        }
      },
      {
        team: "CopyTest - Liquid Death",
        testType: "Copy",
        postA: {
          copy: "Even better than blood",
          image: "https://drive.google.com/uc?export=view&id=1KtejAuo6_w_plhPdPbTgqNkBormcn8QM"
        },
        postB: {
          copy: "The dead's go-to drink",
          image: "https://drive.google.com/uc?export=view&id=1bg5j3vTbkuxUGFcm0waTeEf-paFQQjvV"
        }
      },
      {
        team: "ImageTest - Liquid Death Skate",
        testType: "Image",
        postA: {
          copy: "Kickflips & cans üíÄüíß Hydrating the chaos with #LiquidDeath ‚Äî murder your thirst, not your vibe. üõπüî•",
          image: "https://drive.google.com/uc?export=view&id=124nvxQbu2X6hNY6yMdqM1ydWO2uJAKAw"
        },
        postB: {
          copy: "Kickflips & cans üíÄüíß Hydrating the chaos with #LiquidDeath ‚Äî murder your thirst, not your vibe. üõπüî•",
          image: "https://drive.google.com/uc?export=view&id=1Bsw7F4Vyr-TNmy1JF-wJdPtJR-ER1Tvf"
        }
      },
      {
        team: "ImageTest - Wegmans Fresh",
        testType: "Image",
        postA: {
          copy: "Fresh flavors, unforgettable moments‚ÄîWegmans brings the best to your table every day.",
          image: "https://drive.google.com/uc?export=view&id=1slRrocZHObPIW9t8mJDu4WjNVqITfOeo"
        },
        postB: {
          copy: "Fresh flavors, unforgettable moments‚ÄîWegmans brings the best to your table every day.",
          image: "https://drive.google.com/uc?export=view&id=13NPr2uEVjyW4Kc0adbqgHzccISEGACEu"
        }
      },
      {
        team: "CopyTest - Jimmy Johns",
        testType: "Copy",
        postA: {
          copy: "Its a big dill üòâü•í",
          image: "https://drive.google.com/uc?export=view&id=1Ks303cXLULMj4hoKk6YDIHGeG8FqIREO"
        },
        postB: {
          copy: "can't talk rn, surfing through flavor space on a #JimmyJohns sub üåä",
          image: "https://drive.google.com/uc?export=view&id=1EdAe7gBErcxsAcertS6PspT7h_NstH7I"
        }
      },
      {
        team: "ImageTest - Crocs",
        testType: "Image",
        postA: {
          copy: "There's nothing better than Crocs.",
          image: "https://drive.google.com/uc?export=view&id=1I6Y6CU3LHgaLcgpG9TpP1fuVKnHyDS"
        },
        postB: {
          copy: "There's nothing better than Crocs.",
          image: "https://drive.google.com/uc?export=view&id=1eib0pbD0PmhD3xaUpT78rlg6fRd5VOJb"
        }
      },
      {
        team: "ImageTest - Arby's",
        testType: "Image",
        postA: {
          copy: "chicken nuggets are for kids, steak nuggets are for men. Try 'em now, thank us later",
          image: "https://drive.google.com/uc?export=view&id=1xJCPYPiDlSw_rnhV32zzs4Q0cWMv29gY"
        },
        postB: {
          copy: "chicken nuggets are for kids, steak nuggets are for men. Try 'em now, thank us later",
          image: "https://drive.google.com/uc?export=view&id=1QUkNZxL_qwDFqRZnbV3HTeo89y7sG2Ql"
        }
      },
      {
        team: "ImageTest - Liquid Death Metal",
        testType: "Image",
        postA: {
          copy: "Most Metal Way to Stay Hydrated",
          image: "https://drive.google.com/uc?export=view&id=1ZzseUkWRntackRWgS4ePY73XVOjDo7zN"
        },
        postB: {
          copy: "Most Metal Way to Stay Hydrated",
          image: "https://drive.google.com/uc?export=view&id=1VJDNWrwbi6o3r-opxcrgbxS-ouEK6oSO"
        }
      },
      {
        team: "CopyTest - Denny's Existential",
        testType: "Copy",
        postA: {
          copy: "decomposing but make it ‚ú®breakfast‚ú®",
          image: "https://drive.google.com/uc?export=view&id=1BaswOsVhmws_KCTxq6EiSXNElaYC_zF3"
        },
        postB: {
          copy: "The world outside crumbles. Inside, the pancakes whisper, 'You're safe here.'",
          image: "https://drive.google.com/uc?export=view&id=12_6D21iujFZKeTLBqXXBwijgGPUZYggQ"
        }
      },
      {
        team: "ImageTest - Wegmans Ascend",
        testType: "Image",
        postA: {
          copy: "Fresh. Local. Legendary. ‚ú® You don't just shop at Wegmans. You ascend to better food and brighter meals.",
          image: "https://drive.google.com/uc?export=view&id=1yqwxGU9xGHjIx9A1T4EHxPzsDZO9FIVs"
        },
        postB: {
          copy: "Fresh. Local. Legendary. ‚ú® You don't just shop at Wegmans. You ascend to better food and brighter meals.",
          image: "https://drive.google.com/uc?export=view&id=1Q-XQbE1ynhDaXHlnyXCp4jDSskTt_lvl"
        }
      }
    ];

    // Data export function
    function downloadDataAsCSV(userName, votes, comments) {
      const rows = [];

      // Header row
      rows.push(['Student Name', 'Test Name', 'Test Type', 'Variant Selected', 'Variant A Click Likelihood', 'Variant B Click Likelihood', 'Comment', 'Timestamp']);

      // Data rows
      ABTestData.forEach((test, idx) => {
        const voteData = votes[idx];
        if (voteData && voteData.voters && voteData.voters.length > 0) {
          voteData.voters.forEach((voter) => {
            const testComments = comments[idx] || [];
            const voterComment = testComments.find(c => c.name === voter.name && c.timestamp === voter.timestamp);

            rows.push([
              voter.name,
              test.team,
              test.testType,
              `Variant ${voter.preference}`,
              voter.likelihoodA,
              voter.likelihoodB,
              voterComment ? `"${voterComment.text.replace(/"/g, '""')}"` : '',
              new Date(voter.timestamp).toLocaleString()
            ]);
          });
        }
      });

      // Convert to CSV string
      const csvContent = rows.map(row => row.join(',')).join('\\n');

      // Create download
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);

      link.setAttribute('href', url);
      link.setAttribute('download', `ABTest_${userName}_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';

      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function ABTestingVoter() {
      const [currentTest, setCurrentTest] = useState(0);
      const [viewMode, setViewMode] = useState('voting');
      const [votes, setVotes] = useState(() => {
        const saved = localStorage.getItem('abTestVotes');
        return saved ? JSON.parse(saved) : {};
      });
      const [comments, setComments] = useState(() => {
        const saved = localStorage.getItem('abTestComments');
        return saved ? JSON.parse(saved) : {};
      });
      const [hasVoted, setHasVoted] = useState(false);
      const [userName, setUserName] = useState(() => {
        const saved = localStorage.getItem('abTestUserName');
        return saved || '';
      });

      const test = ABTestData[currentTest];

      useEffect(() => {
        localStorage.setItem('abTestVotes', JSON.stringify(votes));
      }, [votes]);

      useEffect(() => {
        localStorage.setItem('abTestComments', JSON.stringify(comments));
      }, [comments]);

      useEffect(() => {
        if (userName) {
          localStorage.setItem('abTestUserName', userName);
        }
      }, [userName]);

      const handleVote = (preference, likelihoodA, likelihoodB, comment) => {
        const newVotes = { ...votes };
        if (!newVotes[currentTest]) {
          newVotes[currentTest] = { preference: {}, likelihoodA: [], likelihoodB: [], voters: [] };
        }

        newVotes[currentTest].preference[preference] = (newVotes[currentTest].preference[preference] || 0) + 1;
        newVotes[currentTest].likelihoodA.push(likelihoodA);
        newVotes[currentTest].likelihoodB.push(likelihoodB);
        newVotes[currentTest].voters.push({
          name: userName,
          preference,
          likelihoodA,
          likelihoodB,
          timestamp: new Date().toISOString()
        });

        setVotes(newVotes);

        if (comment && comment.trim()) {
          const newComments = { ...comments };
          if (!newComments[currentTest]) {
            newComments[currentTest] = [];
          }
          newComments[currentTest].push({
            name: userName,
            text: comment,
            timestamp: new Date().toISOString()
          });
          setComments(newComments);
        }

        setHasVoted(true);
      };

      const nextTest = () => {
        if (currentTest < ABTestData.length - 1) {
          setCurrentTest(currentTest + 1);
          setHasVoted(false);
          setViewMode('voting');
        } else {
          setViewMode('summary');
        }
      };

      const previousTest = () => {
        if (currentTest > 0) {
          setCurrentTest(currentTest - 1);
          setHasVoted(false);
          setViewMode('voting');
        }
      };

      const resetAll = () => {
        setCurrentTest(0);
        setVotes({});
        setHasVoted(false);
        setViewMode('voting');
      };

      if (!userName) {
        return <UserNamePrompt onSetName={setUserName} />;
      }

      if (viewMode === 'summary') {
        return <SummaryView votes={votes} comments={comments} userName={userName} data={ABTestData} onReset={resetAll} onViewAnalytics={() => setViewMode('analytics')} />;
      }

      if (viewMode === 'analytics') {
        return <AnalyticsView votes={votes} comments={comments} userName={userName} data={ABTestData} onBack={() => setViewMode('summary')} />;
      }

      const currentVoteData = votes[currentTest];
      const totalVotes = currentVoteData ?
        (currentVoteData.preference.A || 0) + (currentVoteData.preference.B || 0) : 0;

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-orange-100 p-6">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex justify-between items-center">
                <div>
                  <h1 className="text-3xl font-bold text-orange-600">A/B Test Voting</h1>
                  <p className="text-gray-600 mt-1">Test {currentTest + 1} of {ABTestData.length}</p>
                  <p className="text-sm text-gray-500 mt-1">Logged in as: <span className="font-semibold">{userName}</span></p>
                </div>
                <div className="text-right">
                  <p className="text-sm text-gray-500">{test.testType} Test</p>
                  <p className="text-lg font-semibold text-gray-800">{test.team}</p>
                </div>
              </div>

              <div className="mt-4 bg-gray-200 rounded-full h-2">
                <div
                  className="bg-orange-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${((currentTest + 1) / ABTestData.length) * 100}%` }}
                />
              </div>
            </div>

            {viewMode === 'voting' && !hasVoted && (
              <VotingView test={test} onVote={handleVote} />
            )}

            {hasVoted && (
              <ResultsView
                test={test}
                voteData={currentVoteData}
                comments={comments[currentTest] || []}
                totalVotes={totalVotes}
                onNext={nextTest}
                onPrevious={previousTest}
                isFirst={currentTest === 0}
                isLast={currentTest === ABTestData.length - 1}
              />
            )}
          </div>
        </div>
      );
    }

    function UserNamePrompt({ onSetName }) {
      const [name, setName] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        if (name.trim()) {
          onSetName(name.trim());
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center p-6">
          <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
            <h1 className="text-3xl font-bold text-orange-600 mb-4">Welcome to A/B Test Voting</h1>
            <p className="text-gray-600 mb-6">Please enter your name to get started. Your responses will help analyze social media engagement patterns.</p>
            <form onSubmit={handleSubmit}>
              <input
                type="text"
                value={name}
                onChange={(e) => setName(e.target.value)}
                placeholder="Enter your name"
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-600 focus:outline-none mb-4"
                required
              />
              <button
                type="submit"
                className="w-full py-3 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition-all"
              >
                Start Voting
              </button>
            </form>
          </div>
        </div>
      );
    }

    function VotingView({ test, onVote }) {
      const [selectedPreference, setSelectedPreference] = useState(null);
      const [likelihoodA, setLikelihoodA] = useState(3);
      const [likelihoodB, setLikelihoodB] = useState(3);
      const [comment, setComment] = useState('');

      const handleSubmit = () => {
        if (selectedPreference) {
          onVote(selectedPreference, likelihoodA, likelihoodB, comment);
        }
      };

      return (
        <div className="space-y-6">
          <div className="grid md:grid-cols-2 gap-6">
            <div className={`bg-white rounded-lg shadow-lg overflow-hidden border-4 transition-all ${
              selectedPreference === 'A' ? 'border-orange-600' : 'border-transparent'
            }`}>
              <div className="bg-orange-600 text-white p-4">
                <h3 className="text-xl font-bold">Variant A</h3>
              </div>
              <div className="p-4">
                <img
                  src={test.postA.image}
                  alt="Variant A"
                  className="w-full h-64 object-cover rounded-lg mb-4"
                />
                <p className="text-gray-800 text-lg leading-relaxed">{test.postA.copy}</p>
              </div>
              <div className="p-4 bg-gray-50">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  How likely to click? (1-5)
                </label>
                <input
                  type="range"
                  min="1"
                  max="5"
                  value={likelihoodA}
                  onChange={(e) => setLikelihoodA(parseInt(e.target.value))}
                  className="w-full"
                />
                <div className="flex justify-between text-xs text-gray-600 mt-1">
                  <span>Not likely</span>
                  <span className="font-bold text-orange-600 text-lg">{likelihoodA}</span>
                  <span>Very likely</span>
                </div>
              </div>
            </div>

            <div className={`bg-white rounded-lg shadow-lg overflow-hidden border-4 transition-all ${
              selectedPreference === 'B' ? 'border-orange-600' : 'border-transparent'
            }`}>
              <div className="bg-gray-700 text-white p-4">
                <h3 className="text-xl font-bold">Variant B</h3>
              </div>
              <div className="p-4">
                <img
                  src={test.postB.image}
                  alt="Variant B"
                  className="w-full h-64 object-cover rounded-lg mb-4"
                />
                <p className="text-gray-800 text-lg leading-relaxed">{test.postB.copy}</p>
              </div>
              <div className="p-4 bg-gray-50">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  How likely to click? (1-5)
                </label>
                <input
                  type="range"
                  min="1"
                  max="5"
                  value={likelihoodB}
                  onChange={(e) => setLikelihoodB(parseInt(e.target.value))}
                  className="w-full"
                />
                <div className="flex justify-between text-xs text-gray-600 mt-1">
                  <span>Not likely</span>
                  <span className="font-bold text-gray-700 text-lg">{likelihoodB}</span>
                  <span>Very likely</span>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Which variant would you engage with?</h3>
            <div className="flex gap-4">
              <button
                onClick={() => setSelectedPreference('A')}
                className={`flex-1 py-4 px-6 rounded-lg font-bold text-xl transition-all ${
                  selectedPreference === 'A'
                    ? 'bg-orange-600 text-white shadow-lg scale-105'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Vote for Variant A
              </button>
              <button
                onClick={() => setSelectedPreference('B')}
                className={`flex-1 py-4 px-6 rounded-lg font-bold text-xl transition-all ${
                  selectedPreference === 'B'
                    ? 'bg-gray-700 text-white shadow-lg scale-105'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                Vote for Variant B
              </button>
            </div>

            {selectedPreference && (
              <>
                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    Add a comment (optional)
                  </label>
                  <textarea
                    value={comment}
                    onChange={(e) => setComment(e.target.value)}
                    placeholder="Share your thoughts on this A/B test..."
                    className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-orange-600 focus:outline-none resize-none"
                    rows="3"
                  />
                </div>
                <button
                  onClick={handleSubmit}
                  className="w-full mt-4 py-3 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition-all"
                >
                  Submit Vote
                </button>
              </>
            )}
          </div>
        </div>
      );
    }

    function ResultsView({ test, voteData, comments, totalVotes, onNext, onPrevious, isFirst, isLast }) {
      const preferenceA = voteData?.preference.A || 0;
      const preferenceB = voteData?.preference.B || 0;
      const percentA = totalVotes > 0 ? ((preferenceA / totalVotes) * 100).toFixed(1) : 0;
      const percentB = totalVotes > 0 ? ((preferenceB / totalVotes) * 100).toFixed(1) : 0;

      const avgLikelihoodA = voteData?.likelihoodA.length > 0
        ? (voteData.likelihoodA.reduce((a, b) => a + b, 0) / voteData.likelihoodA.length).toFixed(2)
        : 0;
      const avgLikelihoodB = voteData?.likelihoodB.length > 0
        ? (voteData.likelihoodB.reduce((a, b) => a + b, 0) / voteData.likelihoodB.length).toFixed(2)
        : 0;

      const chartData = [
        { name: 'Variant A', Preference: preferenceA, 'Avg Likelihood': parseFloat(avgLikelihoodA) },
        { name: 'Variant B', Preference: preferenceB, 'Avg Likelihood': parseFloat(avgLikelihoodB) },
      ];

      return (
        <div className="space-y-6">
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-800 mb-4">Results</h2>
            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-orange-50 rounded-lg p-4">
                <h3 className="text-lg font-bold text-orange-600 mb-2">Variant A</h3>
                <p className="text-4xl font-bold text-gray-800">{preferenceA} votes ({percentA}%)</p>
                <p className="text-sm text-gray-600 mt-2">Avg Click Likelihood: {avgLikelihoodA}/5</p>
              </div>
              <div className="bg-gray-100 rounded-lg p-4">
                <h3 className="text-lg font-bold text-gray-700 mb-2">Variant B</h3>
                <p className="text-4xl font-bold text-gray-800">{preferenceB} votes ({percentB}%)</p>
                <p className="text-sm text-gray-600 mt-2">Avg Click Likelihood: {avgLikelihoodB}/5</p>
              </div>
            </div>

            {totalVotes > 0 && (
              <div className={`mt-4 p-4 rounded-lg text-center ${
                preferenceA > preferenceB ? 'bg-orange-600' :
                preferenceB > preferenceA ? 'bg-gray-700' :
                'bg-yellow-500'
              } text-white`}>
                <p className="text-2xl font-bold">
                  {preferenceA > preferenceB ? 'üéâ Variant A Wins!' :
                   preferenceB > preferenceA ? 'üéâ Variant B Wins!' :
                   'ü§ù It\'s a Tie!'}
                </p>
              </div>
            )}
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">Visual Comparison</h3>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={chartData}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Bar dataKey="Preference" fill="#f76902" />
                <Bar dataKey="Avg Likelihood" fill="#4b5563" />
              </BarChart>
            </ResponsiveContainer>
          </div>

          {comments && comments.length > 0 && (
            <div className="bg-white rounded-lg shadow-lg p-6">
              <h3 className="text-xl font-bold text-gray-800 mb-4">Comments ({comments.length})</h3>
              <div className="space-y-3">
                {comments.map((comment, idx) => (
                  <div key={idx} className="border-l-4 border-orange-600 pl-4 py-2 bg-orange-50">
                    <p className="text-gray-800">{comment.text}</p>
                    <p className="text-xs text-gray-600 mt-1">
                      ‚Äî {comment.name} | {new Date(comment.timestamp).toLocaleString()}
                    </p>
                  </div>
                ))}
              </div>
            </div>
          )}

          <div className="flex gap-4">
            <button
              onClick={onPrevious}
              disabled={isFirst}
              className={`px-6 py-3 rounded-lg font-bold ${
                isFirst
                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                  : 'bg-gray-600 text-white hover:bg-gray-700'
              }`}
            >
              ‚Üê Previous Test
            </button>
            <button
              onClick={onNext}
              className="flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700"
            >
              {isLast ? 'View Summary ‚Üí' : 'Next Test ‚Üí'}
            </button>
          </div>
        </div>
      );
    }

    function SummaryView({ votes, comments, userName, data, onReset, onViewAnalytics }) {
      const summaryData = data.map((test, index) => {
        const voteData = votes[index];
        const prefA = voteData?.preference.A || 0;
        const prefB = voteData?.preference.B || 0;
        const total = prefA + prefB;
        const winner = prefA > prefB ? 'A' : prefB > prefA ? 'B' : 'Tie';
        const commentCount = comments[index]?.length || 0;

        return {
          team: test.team,
          testType: test.testType,
          winner,
          totalVotes: total,
          percentA: total > 0 ? ((prefA / total) * 100).toFixed(1) : 0,
          percentB: total > 0 ? ((prefB / total) * 100).toFixed(1) : 0,
          commentCount,
        };
      });

      const handleDownloadData = () => {
        downloadDataAsCSV(userName, votes, comments);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-orange-100 p-6">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-8">
              <h1 className="text-3xl font-bold text-orange-600 mb-6">A/B Testing Summary</h1>

              <div className="space-y-4">
                {summaryData.map((item, index) => (
                  <div key={index} className="border-b pb-4">
                    <div className="flex justify-between items-center">
                      <div>
                        <h3 className="font-bold text-gray-800">{item.team}</h3>
                        <p className="text-sm text-gray-600">{item.testType} Test</p>
                      </div>
                      <div className="text-right">
                        <p className={`text-2xl font-bold ${
                          item.winner === 'A' ? 'text-orange-600' :
                          item.winner === 'B' ? 'text-gray-700' :
                          'text-yellow-600'
                        }`}>
                          {item.winner === 'Tie' ? 'Tie' : `Variant ${item.winner} Wins`}
                        </p>
                        <p className="text-sm text-gray-600">
                          A: {item.percentA}% | B: {item.percentB}% | Total votes: {item.totalVotes} | Comments: {item.commentCount}
                        </p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-8 space-y-4">
                <button
                  onClick={handleDownloadData}
                  className="w-full py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  Download My Data (CSV)
                </button>

                <div className="grid md:grid-cols-2 gap-4">
                  <button
                    onClick={onViewAnalytics}
                    className="py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700"
                  >
                    View Analytics Dashboard
                  </button>
                  <button
                    onClick={onReset}
                    className="py-3 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700"
                  >
                    Start New Session
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function AnalyticsView({ votes, comments, userName, data, onBack }) {
      const totalTests = data.length;
      const testsWithVotes = Object.keys(votes).filter(k => {
        const v = votes[k];
        return (v?.preference?.A || 0) + (v?.preference?.B || 0) > 0;
      }).length;

      const totalVotes = Object.values(votes).reduce((sum, v) => {
        return sum + (v?.preference?.A || 0) + (v?.preference?.B || 0);
      }, 0);

      const totalComments = Object.values(comments).reduce((sum, c) => sum + (c?.length || 0), 0);

      const testTypeStats = {};
      data.forEach((test, idx) => {
        if (!testTypeStats[test.testType]) {
          testTypeStats[test.testType] = { total: 0, aWins: 0, bWins: 0, ties: 0 };
        }
        testTypeStats[test.testType].total++;

        const voteData = votes[idx];
        if (voteData) {
          const prefA = voteData.preference?.A || 0;
          const prefB = voteData.preference?.B || 0;
          if (prefA > prefB) testTypeStats[test.testType].aWins++;
          else if (prefB > prefA) testTypeStats[test.testType].bWins++;
          else if (prefA === prefB && prefA > 0) testTypeStats[test.testType].ties++;
        }
      });

      const avgEngagementA = [];
      const avgEngagementB = [];
      Object.values(votes).forEach(v => {
        if (v?.likelihoodA) avgEngagementA.push(...v.likelihoodA);
        if (v?.likelihoodB) avgEngagementB.push(...v.likelihoodB);
      });

      const overallAvgA = avgEngagementA.length > 0
        ? (avgEngagementA.reduce((a, b) => a + b, 0) / avgEngagementA.length).toFixed(2)
        : 0;
      const overallAvgB = avgEngagementB.length > 0
        ? (avgEngagementB.reduce((a, b) => a + b, 0) / avgEngagementB.length).toFixed(2)
        : 0;

      let aWins = 0, bWins = 0, ties = 0;
      Object.values(votes).forEach(v => {
        const prefA = v?.preference?.A || 0;
        const prefB = v?.preference?.B || 0;
        if (prefA > prefB) aWins++;
        else if (prefB > prefA) bWins++;
        else if (prefA === prefB && prefA > 0) ties++;
      });

      const testTypeChartData = Object.entries(testTypeStats).map(([type, stats]) => ({
        testType: type,
        'A Wins': stats.aWins,
        'B Wins': stats.bWins,
        'Ties': stats.ties
      }));

      const engagementDistribution = [
        { score: '1', countA: avgEngagementA.filter(x => x === 1).length, countB: avgEngagementB.filter(x => x === 1).length },
        { score: '2', countA: avgEngagementA.filter(x => x === 2).length, countB: avgEngagementB.filter(x => x === 2).length },
        { score: '3', countA: avgEngagementA.filter(x => x === 3).length, countB: avgEngagementB.filter(x => x === 3).length },
        { score: '4', countA: avgEngagementA.filter(x => x === 4).length, countB: avgEngagementB.filter(x => x === 4).length },
        { score: '5', countA: avgEngagementA.filter(x => x === 5).length, countB: avgEngagementB.filter(x => x === 5).length }
      ];

      const handleDownloadData = () => {
        downloadDataAsCSV(userName, votes, comments);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-6">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-blue-600">Social Media Analytics Dashboard</h1>
                <div className="flex gap-4">
                  <button
                    onClick={handleDownloadData}
                    className="px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 flex items-center gap-2"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Download Data
                  </button>
                  <button
                    onClick={onBack}
                    className="px-6 py-2 bg-gray-600 text-white rounded-lg font-bold hover:bg-gray-700"
                  >
                    ‚Üê Back to Summary
                  </button>
                </div>
              </div>

              <div className="grid md:grid-cols-4 gap-6 mb-8">
                <div className="bg-gradient-to-br from-orange-100 to-orange-200 rounded-lg p-6">
                  <h3 className="text-sm font-semibold text-orange-800 mb-2">Total Votes</h3>
                  <p className="text-4xl font-bold text-orange-900">{totalVotes}</p>
                </div>
                <div className="bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg p-6">
                  <h3 className="text-sm font-semibold text-blue-800 mb-2">Total Comments</h3>
                  <p className="text-4xl font-bold text-blue-900">{totalComments}</p>
                </div>
                <div className="bg-gradient-to-br from-green-100 to-green-200 rounded-lg p-6">
                  <h3 className="text-sm font-semibold text-green-800 mb-2">Tests Completed</h3>
                  <p className="text-4xl font-bold text-green-900">{testsWithVotes}/{totalTests}</p>
                </div>
                <div className="bg-gradient-to-br from-purple-100 to-purple-200 rounded-lg p-6">
                  <h3 className="text-sm font-semibold text-purple-800 mb-2">Avg Engagement</h3>
                  <p className="text-4xl font-bold text-purple-900">{((parseFloat(overallAvgA) + parseFloat(overallAvgB)) / 2).toFixed(2)}/5</p>
                </div>
              </div>

              <div className="mb-8">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Overall Winner Distribution</h2>
                <div className="grid md:grid-cols-3 gap-4">
                  <div className="bg-orange-50 border-2 border-orange-600 rounded-lg p-4 text-center">
                    <p className="text-orange-600 font-semibold mb-2">Variant A Wins</p>
                    <p className="text-5xl font-bold text-orange-700">{aWins}</p>
                    <p className="text-sm text-gray-600 mt-2">{testsWithVotes > 0 ? ((aWins / testsWithVotes) * 100).toFixed(1) : 0}% of tested</p>
                  </div>
                  <div className="bg-gray-50 border-2 border-gray-600 rounded-lg p-4 text-center">
                    <p className="text-gray-600 font-semibold mb-2">Variant B Wins</p>
                    <p className="text-5xl font-bold text-gray-700">{bWins}</p>
                    <p className="text-sm text-gray-600 mt-2">{testsWithVotes > 0 ? ((bWins / testsWithVotes) * 100).toFixed(1) : 0}% of tested</p>
                  </div>
                  <div className="bg-yellow-50 border-2 border-yellow-600 rounded-lg p-4 text-center">
                    <p className="text-yellow-600 font-semibold mb-2">Ties</p>
                    <p className="text-5xl font-bold text-yellow-700">{ties}</p>
                    <p className="text-sm text-gray-600 mt-2">{testsWithVotes > 0 ? ((ties / testsWithVotes) * 100).toFixed(1) : 0}% of tested</p>
                  </div>
                </div>
              </div>

              <div className="mb-8">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Performance by Test Type</h2>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={testTypeChartData}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="testType" />
                    <YAxis />
                    <Tooltip />
                    <Legend />
                    <Bar dataKey="A Wins" fill="#f76902" />
                    <Bar dataKey="B Wins" fill="#4b5563" />
                    <Bar dataKey="Ties" fill="#eab308" />
                  </BarChart>
                </ResponsiveContainer>
              </div>

              <div className="mb-8">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Click Likelihood Distribution</h2>
                <div className="grid md:grid-cols-2 gap-6 mb-4">
                  <div className="bg-orange-50 rounded-lg p-4">
                    <h3 className="text-lg font-bold text-orange-600 mb-2">Variant A</h3>
                    <p className="text-3xl font-bold text-gray-800">Avg: {overallAvgA}/5</p>
                    <p className="text-sm text-gray-600">{avgEngagementA.length} total ratings</p>
                  </div>
                  <div className="bg-gray-50 rounded-lg p-4">
                    <h3 className="text-lg font-bold text-gray-700 mb-2">Variant B</h3>
                    <p className="text-3xl font-bold text-gray-800">Avg: {overallAvgB}/5</p>
                    <p className="text-sm text-gray-600">{avgEngagementB.length} total ratings</p>
                  </div>
                </div>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={engagementDistribution}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="score" label={{ value: 'Likelihood Score', position: 'insideBottom', offset: -5 }} />
                    <YAxis label={{ value: 'Count', angle: -90, position: 'insideLeft' }} />
                    <Tooltip />
                    <Legend />
                    <Bar dataKey="countA" name="Variant A" fill="#f76902" />
                    <Bar dataKey="countB" name="Variant B" fill="#4b5563" />
                  </BarChart>
                </ResponsiveContainer>
              </div>

              <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Key Insights for Social Media Analysts</h2>
                <div className="space-y-3">
                  <div className="bg-white rounded-lg p-4 shadow">
                    <h4 className="font-bold text-gray-800 mb-2">1. Variant Performance</h4>
                    <p className="text-gray-700">
                      {aWins > bWins
                        ? `Variant A performed better overall, winning ${aWins} out of ${testsWithVotes} tests (${testsWithVotes > 0 ? ((aWins / testsWithVotes) * 100).toFixed(1) : 0}%).`
                        : bWins > aWins
                        ? `Variant B performed better overall, winning ${bWins} out of ${testsWithVotes} tests (${testsWithVotes > 0 ? ((bWins / testsWithVotes) * 100).toFixed(1) : 0}%).`
                        : 'Variants A and B performed equally across tests.'}
                    </p>
                  </div>
                  <div className="bg-white rounded-lg p-4 shadow">
                    <h4 className="font-bold text-gray-800 mb-2">2. Engagement Quality</h4>
                    <p className="text-gray-700">
                      Average click likelihood scores: Variant A = {overallAvgA}/5, Variant B = {overallAvgB}/5.
                      {parseFloat(overallAvgA) > parseFloat(overallAvgB)
                        ? ' Variant A content shows higher engagement potential.'
                        : parseFloat(overallAvgB) > parseFloat(overallAvgA)
                        ? ' Variant B content shows higher engagement potential.'
                        : ' Both variants show similar engagement potential.'}
                    </p>
                  </div>
                  <div className="bg-white rounded-lg p-4 shadow">
                    <h4 className="font-bold text-gray-800 mb-2">3. Test Type Effectiveness</h4>
                    <p className="text-gray-700">
                      {Object.entries(testTypeStats).map(([type, stats], idx) =>
                        `${type} tests: ${stats.aWins + stats.bWins + stats.ties} total${idx < Object.keys(testTypeStats).length - 1 ? ', ' : '.'}`
                      ).join('')}
                    </p>
                  </div>
                  <div className="bg-white rounded-lg p-4 shadow">
                    <h4 className="font-bold text-gray-800 mb-2">4. Community Engagement</h4>
                    <p className="text-gray-700">
                      {totalComments} comments received across all tests. {testsWithVotes > 0 ? `Average of ${(totalComments / testsWithVotes).toFixed(1)} comments per test with votes.` : ''}
                      {totalComments > totalVotes / 2
                        ? ' High comment engagement indicates strong audience interest.'
                        : ' Consider strategies to increase comment participation.'}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ABTestingVoter />);
  </script>
</body>
</html>
